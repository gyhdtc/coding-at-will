基于模糊神经网络优化的分散式储能微网功率平
抑方法
张文惠， 甘毅辉， 杨晓辉
摘要： 文章摘要， 在储能系统中运用分散式结构可以显著提高容量和电压； 但随之而来的问题是如何高效地控制
大量的分散式储能单元。本文针对于此，在前人研究基础上， 提出一种基于模糊神经网络优化的储能单元控制的
方法。 此种神经网络拥有 5 层结构， 将蓄电池组运行参数作为输入， 输出其对应工作模式适配程度的综合量化指
标， 其值大小反应了蓄电池组子模块（Battery Pack Module， BPM）能否胜任此种工作模式；进一步控制器根据
量化值的大小选择，利用快速排序算法进行排序， 合适数量的蓄电池组模块并网工作。在 Matlab/Simulink 环境
下搭建模糊神经网络和微电网模型，进行仿真。 结果验证了此方法的高效性和准确性。与传统策略相比，储能系
统通过模糊神经网络的优化更能平抑功率波动， 同时能够减少蓄电池开机时间、 提高整体平均荷电状态。
关键词： 分散式储能； 模糊神经网络；早期预测； 能量综合管理； 功率平抑
Distributed Energy Storage Micronet Power Stabilizing Method Based on the
Optimization of Fuzzy Neural Network
Abstract: The application of distributed structure in the energy storage system can significantly improve the capacity and voltage,
but the consequent problem is how to efficiently control a large number of distributed energy storage units. On the basis of previous
research, a control method of energy storage unit based on the optimization of fuzzy neural network is proposed to solve the
aforementioned problem. This neural network is constituted by 5 layers, the operation parameters of the energy storage battery were
taken as input data, and the comprehensive quantitative indexes of adaptation degree of corresponding working modes were
outputted, the value of output indicates whether the Battery Pack Module (BPM) can outperform this work mode or not; then use the
controller to select according to the numerical value of quantized value and sort by quick sort algorithm, then implement
grid-connection work by an appropriate number of battery pack module. At last, a fuzzy neural network and a micro grid model was
established under the environment of Matlab/Simulink, and then carry out the simulation. The results proved the high efficiency and
accuracy of this method. The energy storage system has better performance in stabilizing power fluctuation based on the optimization
of fuzzy neural network, compare with the traditional strategies. Meanwhile, it can reduce the starting up time of storage battery and
improve the overall average state of charge.
Key words: distributed energy storage; fuzzy neural network; early prediction; integrated energy management; power stabilizing
0 引言
随着能源的日益短缺，一种由可再生能源发电系
统和储能系统组成的微电网系统逐步发展起来。其
中，储能单元对于微电网的稳定运行、保证电能质量、
紧急供电等具有非常重要的作用，是微电网高效、安
全、经济运行的关键[1-3]。 运用到微电网储能中的设
备多为电化学蓄电池。 虽然蓄电池具有较高的能量密
国家“973”计划资助项目 (2011CB302400)；国家 863 课题（2013AA013804）；国家自然科学基金资助项
目（51765042，61463031，61662044）；江西省科技支撑计划项目（20142BBE50037，20151BBE50050；
度转， 但受限于充电次数和不能深度充放电， 电池寿
命较短且故障率较高。 为了弥补蓄电池的弱点， 蓄电
池-超级电容混合储能系统（hybrid energy storage
system， HESS） 受到学术界广泛关注。 如今， 对于
如何优化配置 HESS 容量， 提高储能设备的效率和寿
命是主要研究方向[4-5]。
学术上常采用分散式储能结构 [5-7],增加储能系
统整体吞吐容量； 但储能单元数量的增多，导致控制
器处理的数据也呈几何倍数增长； 为解决此类问题，
也为了合理管理储能设备、提高储能设备效率， 将擅
于数据处理和分类的算法（神经网络，遗传算法等）运用在电力储能行业成为了近几年的热点[8-10]。 例如
文献[11]采用神经网络模拟出功率平滑度与储能设
备之间的联系，实现了对 HESS 容量的优化配置，最
终结果表明此方案可以使功率更平滑； 文献[12]将蓄
电池的荷电状态进行分级优化，根据储能系统整体荷
电状态来动态设定蓄电池输出功率，此方法能够使得
大部分蓄电池的荷电状态（SOC） 在合适范围，避免
过冲过放。 算法新颖，研究方法严谨， 但用整体平均
荷电状态代表所有个体状态难免不太准确， 不能面面
俱到， 也不能及时发现异常蓄电池。
基于前文对储能系统的研究， 在采用分散式结构
的 HESS 中， 本文设计了一种基于模糊神经网络（FNN）
优化的蓄电池分组投放方法；此方法能够同时且高效
地管理全部储能单元。 整个储能系统结构的不同在于
BPM 与开关并联，可以控制+工作状态；本文进一步
利用 5 层模糊神经网络对 BPM 运行数据进行处理、早
期故障排查，对 BPM 参与“充电”、“放电”、“停机”
三种工作模式的适配程度进行量化；进一步对全部
BPM 指标进行快速排序， 利用希尔排序算法可以大大
缩减时间复杂度[13]；最后在 Matlab/Simulink 中构造
神经网络模型，搭建分布式发电系统和储能系统模
型；利用多组数据让模糊神经网络进行自我学习；得
到全局最优解之后对混合储能系统平抑电网功率波
动进行了仿真实验。
1 结构和工作原理
1.1 结构
HESS 结构的简化图如图 1 所示。如图 1(a)所示，
HESS 结构与传统分散式储能结构类似， 具有传统的
分布式发电系统和负载。储能系统包括： 编号为 1-N
的 BPM、 超级电容和控制装置， 它们直接并联在直
流母线上；整个系统通变压器输入大电网。有一点不
同的是： 超级电容直接并联在直流母线上[14]， 没有通
过 DC/DC 变换器。 这可以充分利用其功率密度高的
特性，在电流快速变化时，超级电容可以抵消掉大部
分高频分量。这不仅简化了电路结构，而且使得蓄电
池充放电电流更加平滑，有效地提高了整个储能系统
的响应速度和稳压能力。
根据本文要实现的功能， 本文在传统蓄电池组储
能结构基础上进行了一点改进， 如图 1(b)。其中蓄
电池组与等效电阻 和电感 串联，蓄电池支路电
流 ,； 一对 IGBT 管 组成变换器， 并在其输出
端并联滤波电容 C 和状态控制开关 ， 其中 是控制
BPM 工作状态的关键。
配电网
同步
发电机
异步风力
发电机
线路1
10K/380V
线路2 线路3 线路4
负荷A
负荷B
PCC
控制器
蓄 电 池
蓄 电 池
蓄 电 池
...
1 2 n
蓄电池储能模块
负载功率、 端电压
图1 HESS结构
Fig.1 HESS Structure
UE
Lm
蓄电池组
Rb S2
S1
C S3
iL
图2 BPM电路结构图
Fig.2 Circuit structure diagram
1.2 工作原理
如图 1(b)所示， 图中包括开关 、 、 ， 其中
控制 DC/DC 变换器， 决定 BPM 的工作状态。
当 BPM 故障， 或者 BPM 不适合当前储能系统的工作
模式（即储能系统工作模式为放电或充电，而蓄电池
剩余电能不足或过剩的情况） 时， 闭合， 将子模块
从系统中切除； 反之， 蓄电池一切正常又能胜任当前
工作模式， 断开；具体见表 1， “1” 表示开关闭
合， “0” 表示开关断开， “X” 表示状态不定。
表 1 工作模式表
Table1 Work mode table
工作模式 (t) 子模块状态
1 1 0 0 >0 放电
2 0 1 0 <0 充电
3 X X 1 =0 切除
储能系统的工作原理就是能量传递的过程。与大
部分混合储能系统原理类似， DC/DC 作为能量流通
的桥梁,使得蓄电池能量可以向电网进行充放电操
作。 如图 1(a)所示， 、 、 、 分别表示
超级电容、 蓄电池、 风力发电网释放的功率和负载吸收功率； 而风电网输出功率极不稳定， 功率的缺口或
功率过剩将对输电网产生不良影响， 所以储能单元的
工作既是稳定母线电压、功率稳定， 可用下列公式表
示为：
 = + = + P P P P P Bat SC V Load
其中 表示功率差， 实际生产工作中 应该尽可能
小。
混合储能系统的控制原理既是对储能单元充放
电电流的控制， 以到达稳定母线频率和电压的目的；
更进一步， 可以通过控制储能单元的容量、 其电路状
态来控制储能单元的 SOC，以到达优化储能单元的
目的。 而本文的重点在于后者， 所以对于传统 PID 算
法与恒流充放电控制策略这里不再赘述， 本文重点介
绍蓄电池组模块的工作模式指标的量化和早期故障
预测。
2 控制策略分析
2.1 模糊神经网络
本文设计的模糊神经网络模型为五层结构，如图
3 所示。从模型入口开始分别为：输入层、模糊层、
推理层、反模糊层、 归一化层。
1 2 3 4
1 2 3 1 2 3 3
1 2 3
α β γ
U R T
SOC
Input
. . . . . . Φ
2 Η
图3 模糊神经网络结构
Fig.3 Indistinct neural network structure
根据电路和电化学的相关知识，蓄电池的端电压
U 、内阻 R 、温度 T 、 荷电状态 SOC ， 这四个运
行参数可以很好的反应蓄电池的工作状态，所以将其
N 组蓄电池的运行参数整合为输入大小为 4 n 的矩
阵， 即图 3 中 Input 为：
1 2
1 2
1 2
1 2
......
......
Input
......
......
n n n
n
U U U
R R R
T T T
SOC SOC SOC
 
 
 
=  
 
 
其中， 矩阵 Input 元素定义为 Inputij ，下标表
示该元素在矩阵的第 i 行， 第 j 列； 矩阵元素 Inputij
下标 j 同时表示 BPM 编号；并且 j 相同的四个元素
组成的列矩阵可以表示 BPM 的运行参数， 用矩阵 D j
表示：
D [ , , , ] ( 1,2,..., ) j j j j j = = Input Input Input Input j n 1 2 3 4 T
第一层输入层有四个节点（编号为 1,2,3,4），
依次读取 D j 送入模糊层。
第二层模糊层进行数据的模糊操作。该层将每个
输入量用“正常”、“中等”、“严重” 3 个模糊子集来
分类描述（每个输入量对应三个模糊子集,该层共十
二个节点），分别以 N、 M、 H 表示。以本文仿真中
铅酸蓄电池为例，设置其参数为： 额定电压 100V，
内阻 25 m ， 连续工作一小时电池体温度 50-60 C ，
室温 25 C 。 表 2 显示了其运行参数与模糊子集之间
的映射：
表 2 模糊子集表
Table2 Fuzzy subset table
运行参数 数值 模糊子集
0～5 N
端电压 5～10 M
10～ H
25～26 N
内阻 R(m ) 26～30 M
30～ H
25～60 N
温度 T 60～80 M
80～ H
30～70 N
荷电状态 SOC（%） 10～30/70～90 M
0～10/90～100 H
同时为了计算输入量属于各个模糊子集的隶属
度， 本文隶属函数选用：( )2
jk exp ,( 1,2,3) ij jk 2
jk
input m
 k

 
= − =   −
 
 
式中下标 j 与输入层对应、下标 k 由上至下依次对应
图 3 中节点。 用矩阵形式表示该层的输出隶属度为：
11 13
41 44
 
 
 
 
 =  
   
第三层推理层中各节点的输出为激活度 hi ，其算
法为该节点所有输入的代数和:
H E , , =  = (h h h 1 2 3 )T
其中 E 为单位矩阵。
第四层反模糊层有三个节点,分别输出蓄电池三
种工作模式适应度的量化指标： 放电模式 1
Y j ，冲电
模式 2
Yj
,停机模式 3
Yj
（对于每个输出， 其数值大表
示此蓄电池组适应此项工作的能力强）； 其算法为输
入数据与三、 四层的连接权的乘积之和：
3
1
, 1,2,3
i
s n
j i
i
Y w h s
=
= = 
其连接权约束条件为：
3
1
in 1, , ,
i
w n   
=
 = =
第五层归一化运算， 使 BPM 对于三种工作模式的
适应度之和为 1， 即：
3
1
j j j s s i , 1,2,3
i
Y Y Y s
=
= = 
并将输出数据整合成输出矩阵 output ：
output=( , , ) output output output 1 2 n
这样的 FNN 结构具有计算简单的特点， 每层具
有明显的物理含义，收敛速度快， 可移植性和操作性
高。
2.2 分散式模块控制策略
为了能够实现蓄电池分组投放策略，控制器要根
据电网输出功率和负载消耗功率的差值，遴选出一部
分 BPM，使得这些子模块恰能平抑功率波动，而蓄电
池本身又工作在额定功率下。 所以本文的控制程序在
选择 BPM 时，应该满足以下原则：
a.蓄电池子模块均匀使用：在放电时，优先使用
电量剩余多的 BPM；在充电时，优先选择电量剩余低
的 BPM；
b.根据电网的需求和模糊神经网络的计算， 优先
选择当前储能系统工作模式下对应工作指标 s
Yj
较高
的 BPM 如：电网电力缺口时，需要储能系统释放能量，
这时优先选择 1
Y j 大的；
c.不选择故障率大于 80%的 BPM；
d.并入电网的 BPM 输出/吸收功率在额定功率
附近；
上 述 控 制 策 略 可 用 图 4 概 括 , 图 中
BPM_xi / BPM_yi 经过希尔排序算法得到。
放电模式 充电模式
高 低
高 低
高 低
优 先 级
BPM_x1
维修
更换
切除
BPM_x2
BPM_xi
BPM_y1
BPM_y2
BPM_yi
. . . . . .
. . . . . .
图4 BPM控制方法
Fig.4 BPM Control method
为了满足上述要求， 并网的蓄电池数量是关键。
下面对其计算的方法进行阐述。
根据蓄电池和超级电容当前的运行参数，将风电
场输出功率与负载功率的差值，通过低通滤波器后，
通过以下公式计算储能系统功率：
1
1 +
= 
sT
P P
out
同时考虑到超级电容的端电压在极短时间内不
能突变以及处于并网状态的蓄电池具有相似的分流
和功率输出能力，为了计算方便认为所有功率都由蓄电池吸收/释放， 即： P P Bat  out ； 进一步通过以下
公式可以估算 BPM 数量 N：
1
Bat
e
Bat e
P
else
N P
P P

= 

 
其中 “||” 表示四舍五入; Pe 为 BPM 额定功率。
3. 控制策略的 MATLAB 仿真验证
本文基于 MATLAB/Simulink 建立了如图 1(a)所
示的混合储能系统仿真模型。
在仿真开始之前， 首先利用 100 组数据对模糊神
经网络进行训练；学习算法采用 BP 算法[15]。 随着训
练次数的增多， 神经网络结构的误差逐渐趋近 0。在
训练次数大于 200 次以后，误差基本小于 0.05，满
足功率平抑仿真中的误差要求。
3.1 风电平抑效果分析
首先利用 6 个 BPM 对 分散式控制策略的可行性
进行仿真验证。仿真参数如下表：异步风力发电机容
量 30KVA，同步发电机容量 30KVA；混合储能系统中，
BPM 参数为额定电压 100V、容量 5A·h、额定功率 1KV
初始 SOC为 80%，超级电容参数为 20F、额定电压 380V；
恒定负载 20KVA。 本次仿真结果如图 9 所示。
图5 平抑效果对比图
Fig.5 Comparison of the effects of depression.
由图 5 的仿真结果可以看出：由于环境因素，采
用风能、太阳能发电的分布式发电系统输出功率变化
幅度很大，波动很明显；因为仿真中负载大小不变，
所以当分布式发电系统输出功率低于 20KW，即系统
时间处于 0 至 t1 秒、 t2 至 600 秒时，储能系统主要
向电网释放功率；反之处于 t1 至 t2 秒时，储能系统
主要从电网吸收功率，最终能够使得输出到电网中的
功率稳定在 19-22KW 之间。
两种算法的对比比较明显，在发电系统输出功率
剧烈波动时， 对比算法的反应滞后，且其输出功率波
动范围更大。其原因是对于工作状态不佳的蓄电池组
模块没有有效的管理，使其一直留在储能系统中工
作， 影响了整体吞吐电能的能力。也恰恰说明了蓄电
池状态对于系统的平抑能力有一定影响，在设计控制
策略时必须考虑它。
为了验证控制策略的效率，仿真还得到了每组蓄
电池工作时间和 SOC，如表 3、 图 6 所示。
表 3 BPM 工作状态表
Table3 BPM Work status table
组别 初始 SOC 工作时间 剩余 SOC 平均功率 KW/s
1 80% 238 28.8% 1.26
2 70% 112 33.2% 1.03
3 60% 67 38.6% 0.98
4 50% 108 28.9% 1.35
5 40% 52 32.3% 1.21
6 30% 150 38.8% 0.92
表 3 示出了每组蓄电池的剩余电量、工作时间和
平均功率。其中， 6 组 BPM 初始 SOC 的极差为 60%；
当仿真结束时，剩余 SOC 均在 28.8%至 38.8%之间，
极差仅有 10%；同时可以看出 6 个 BPM 的工作时间相
对于连续不断工作 600s 大幅减少， 并且平均功率也
在额定功率附近。
图6 蓄电池组模块的SOC状态
Fig.6 The SOC state of the battery module.
图 6 中， BPM 的 SOC 稳定变化， 高频震荡不明显；
同时当系统时间处于图 5 所示的 t1 至 t2 时，此时储
能系统需要吸收功率，控制器选择 SOC 最少的 6 号BPM 作为充电模块，及时为其补充能量， 不至于过度
放电。
从上述结果可以看出获得每个 BPM 的运行状态，
再对它们进行分别控制是有一定优势的。 既可以让蓄
电池更有效的运行，又能维持使得蓄电池均等使用，
减少工作时间。 下面将调整电力系统元件参数， 进一
步仿真。
3.2 基于模糊神经网络优化的能量管理仿真
基于模糊神经网络优化的能量管理仿真在第一
次仿真实验的基础上，将风力发电机和同步发电机容
量增加至 30MVA； BPM 数量从 6 组增加至 300 组，容
量增至 50A·H， 额定功率增加至 10KVA；其他参数不
变。 最终得到储能系统整体 SOC 走势和蓄电池 SOC 分
布概率图， 如图 7、 8 所示。
图7 整体SOC图
Fig.7 The overall figure SOC
图8(a)对比算法
Fig.8(a) Compare the algorithm
图8(b)本文算法
Fig.8(b) In this paper, algorithm
图8 蓄电池组SOC概率分布图
Fig.8 The SOC probability distribution diagram of the battery
group.
观察图 8 可以明显看出本文算法在维持整体平
均 SOC 方面有着积极作用。在仿真实验 0-350s 时间
里， 对比算法的 SOC 普遍低于本文算法。 同时观察曲
线整体，对比算法相较于本文算法也有较大的波动。
正是因为本文内采用了模糊神经网络优化控制， 控制
状态最优的蓄电池参与工作， 从而使整体 SOC 逐步稳
定下降。需要说明的是， 图 8 中， 因为仿真参数设置
为储能系统放电能量大于充电能量， 这使得图 8 中两
条曲线整体为下降趋势。
如图 9(a)、 (b)所示， 因为有了模糊神经网络的
优化， 仿真结束时，本文算法中蓄电池处于正常 SOC
（30%-80%之间） 的比例相对于对比算法提高了 15%，
而处于非正常 SOC 的比例分别减少了 12%和 8%。
同时注意到本文算法中切除了 5%的故障率较大
的 BPM，表 4 选取了四组被切除的 BPM，显示了其被
切除前的运行参数。
4. 结论
分散式储能结构简单，多个储能模块分散地集成
于每个模块中， 增加储能系统容量。但储能单元数量
的增多给控制器带来不小挑战。 本文详细介绍了利用
模糊神经网络对储能单元的控制策略进行优化的方
法。 通过仿真实验，得出该方法可以减少蓄电池使用
时间、 提高整体平均 SOC 从而提高储能系统吞吐能
力。 并且利用模糊神经网络可以有效的筛选出故障储
能单元，并将其切除在电网之外。 本方法原理清晰可靠，工程实践价值高。
参考文献
1. 周念成, 闫立伟, 王强钢.光伏发电在微电网中接入及
动态特性研究[J]. 电力系统保护与控制, 2010 (14):
119-127.
2. 郭力, 王成山.含多种分布式电源的微网动态仿真[J].
电力系统自动化, 2009, 33(2): 82-86.
3. 侯雨伸,王秀丽,刘杰,郭静丽,唐伦.基于拟蒙特卡罗方
法 的 电 力 系 统 可 靠 性 评 估 [J]. 电 网 技
术,2015,39(03):744-750.
4. 向育鹏,卫志农,孙国强,孙永辉,沈海平. 基于全寿命周
期成本的配电网蓄电池储能系统的优化配置[J]. 电
网技术,2015,39(01):264-270.
5. 杨艳红,裴玮,邓卫,沈子奇,齐智平,周勐. 计及蓄电池
储能寿命影响的微电网日前调度优化[J]. 电工技术
学报,2015,30(22):172-180.
6. 吉宇,王生强,曹炀,谢飞,徐晓,徐晓轶.分散式储能
MMC 综 合 控 制 策 略 研 究 [J]. 中 国 电
力,2017,50(10):159-165.
7. 吴雄,王秀丽,刘世民,祝振鹏,刘春阳,段杰,侯菲.微电网
能 量 管 理 系 统 研 究 综 述 [J]. 电 力 自 动 化 设
备,2014,34(10):7-14.
8. 叶林,陈政,赵永宁,朱倩雯.基于遗传算法—模糊径向
基神经网络的光伏发电功率预测模型[J].电力系统自
动化,2015,39(16):16-22.
9. 卢芸,赵永来.基于模糊神经网络风电混合储能系统优
化控制[J].电力系统保护与控制,2014,42(12):113-118.
10. 张俊芳,刘鹏. 基于改进模糊神经网络的配电网故障
选 线 研 究 [J]. 电 力 系 统 保 护 与 控
制,2010,38(22):120-125.
11. 孙承晨,袁越,San Shing CHOI,李梦婷,张新松,曹阳. 基
于经验模态分解和神经网络的微网混合储能容量优
化配置[J]. 电力系统自动化,2015,39(08):19-26.
12. 邹见效,戴碧蓉,彭超,辛晓帅,骆伍巧. 基于荷电状态分
级优化的混合储能风电功率平抑方法[J]. 电力系统
自动化,2013,37(24):1-6.
13. 何智鹏,许建中,苑宾,赵成勇,彭茂兰.采用质因子分解
法与希尔排序算法的 MMC 电容均压策略[J].中国电
机工程学报,2015,35(12):2980-2988.
14. 张国驹,唐西胜,齐智平. 超级电容器与蓄电池混合储
能 系 统 在 微 网 中 的 应 用 [J]. 电 力 系 统 自 动
化,2010,34(12):85-89.
15. 张俊芳,刘鹏.基于改进模糊神经网络的配电网故障选
线 研 究 [J]. 电 力 系 统 保 护 与 控
制,2010,38(22)